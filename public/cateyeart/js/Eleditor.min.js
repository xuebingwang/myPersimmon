/**
* Version: 1.5
* Title: Eleditor 移动端富文本编辑器
* Site: https://eleditor.fixel.cn
* Author: Try
*/
(function(k){var h="1.5";var c="Eleditor";var a=["INPUT","IMG","TEXTAREA"];var e={insertText:"插文字",insertImage:"插图片",insertLink:"插链接",insertHr:"水平线",deleteBefore:"删除前",deleteAfter:"删除后",editText:"改文字",deleteThis:"删除",undo:"撤销",cancel:"取消",};var i="";k[c]=function(){};if(typeof jQuery==="undefined"&&typeof Zepto==="undefined"){return console.warn("|--Eleditor 请引入jQuery或者Zepto！")}else{if(typeof f==="undefined"){var f=typeof jQuery!="undefined"?jQuery:Zepto}}var g=function(p){var o=document.scripts;o=o[o.length-1].src.substring(0,o[o.length-1].src.lastIndexOf("/")+1);p(o);return o}(function(o){var p='<link rel="stylesheet" href="'+o+'layout/base.css">';f("head").append(p)});var l=function(q,o){for(var p in o){if(o[p]==q){return true}}return false};var n=function(o){var p=o.replace(/\ +/g,"");p=o.replace(/[ ]/g,"");p=o.replace(/[\r\n]/g,"");return p.replace(/(^\s*)|(\s*$)/g,"")};var b=function(){var o=Math.max.apply(null,f.map(f("body *"),function(q){var p=f(q);if(p.css("position")!="static"){return parseInt(p.css("z-index"))||1}}));return(o+"").indexOf("Infinity")>=0?1:o+1};var j=function(){return c+""+ +new Date};var d=function(){var p=arguments[0],o=arguments[1];if(n(p.text())==""&&p.find("img").length===0){p.append(o)}if(p.find("*").length===0){p.html('<p class="Eleditor-placeholder">'+p.html()+"</p>")}};var m=function(u,t){var q='<div class="Eleditor-wrap" style="z-index:'+b()+'" id="'+t+'"><div class="Eleditor-controller"><ul>';for(var s=0;s<u.length;s++){var v=u[s],r=typeof v==="object"?v.id:v,p=(typeof v==="object"&&v.tag)?v.tag.toLocaleLowerCase():null,o=typeof v==="object"?v.name:e[v];q+='<li event="'+r+'" '+(p?'on-tag="'+p+'"':"")+' class="Eleditor-'+r+'">'+o+"</li>"}q+='</ul></div><div class="Eleditor-loading"><p></p></div><div class="Eleditor-textEditor"><div class="Eleditor-textStyle"><ul><li class="Eleditor-textStyle-bold"></li><li class="Eleditor-textStyle-color"><span></span></li><li class="Eleditor-textStyle-underline"><span></span></li><li class="Eleditor-textStyle-bgColor"></li><li class="Eleditor-textStyle-fontSize"></li><li class="Eleditor-textStyle-lineHeight"></li><li class="Eleditor-textStyle-align Eleditor-textStyle-alignLeft" align="left"></li><li class="Eleditor-textStyle-align Eleditor-textStyle-alignCenter" align="center"></li><li class="Eleditor-textStyle-align Eleditor-textStyle-alignRight" align="right"></li></ul><button class="Eleditor-textEditor-clean">清空</button></div><div class="Eleditor-textEditor-colors"><div class="Eleditor-textEditor-modulePane"><span></span></div><ul><li><span style="background-color:#000000;"></span></li><li><span style="background-color:#0f3efe;"></span></li><li><span style="background-color:#a97a46;"></span></li><li><span style="background-color:#03fcfe;"></span></li><li><span style="background-color:#00f72c;"></span></li><li><span style="background-color:#ff4cfd;"></span></li><li><span style="background-color:#fc951e;"></span></li><li><span style="background-color:#932890;"></span></li><li><span style="background-color:#ff2a1a;"></span></li><li><span style="background-color:#fdf935;"></span></li><li><span style="background-color:#ffffff;border: 1px solid #ccc;"></span></li><li><span class="Eleditor-inheritValue" style="background-color:transparent; border: 1px solid #dedede;"></span></li></ul></div><div class="Eleditor-textEditor-fontsizes"><div class="Eleditor-textEditor-modulePane"><span>字体大小</span></div><ul><li class="Eleditor-inheritValue">默认</li><li>14px</li><li>16px</li><li>20px</li><li>28px</li><li>35px</li></ul></div><div class="Eleditor-textEditor-lineheight"><div class="Eleditor-textEditor-modulePane"><span>行高</span></div><ul><li class="Eleditor-inheritValue">默认</li><li>20px</li><li>25px</li><li>30px</li><li>35px</li><li>40px</li></ul></div><div class="Eleditor-inputarea"><input placeholder="请输入超链接" type="text" /><div class="textarea" contenteditable="true"></div></div><div class="Eleditor-method"><button class="Eleditor-commit">提交</button><button class="Eleditor-cancel">取消</button></div></div></div>';return q};k[c]=function(){console.log("|--Eleditor Initing");var B=arguments[0];B.upload=B.upload||{};B.toolbars=B.toolbars||[],_editorUid=j(),_historys=[],_placeHolder=B.placeHolder||'<p class="Eleditor-placeholder">点击此处编辑内容</p>';if(B.toolbars.length===0){B.toolbars=["insertText","editText","insertImage","insertLink","deleteBefore","deleteAfter","insertHr","deleteThis","undo","cancel",]}if(B.el instanceof jQuery){var t=B.el}else{var t=f(B.el);if(t.length===0){return console.warn("|--Eleditor "+B.el+"元素不存在，请在DOMContentLoaded后初始化Eleditor")}else{if(t.length!=1){var t=f(t[0])}}}if(t.attr("Eleditor-Inited")==="true"){return console.warn("|--Eleditor "+B.el+"已经绑定了Eleditor")}t.attr({"Eleditor-Inited":"true","Eleditor-Uid":_editorUid});d(t,_placeHolder);var R=f(k);var P=f("html,body");var C=f(m(B.toolbars,_editorUid));var I=C.find(".Eleditor-controller");var w=C.find(".Eleditor-loading");var o=C.find(".Eleditor-textEditor");var N=o.find(".Eleditor-inputarea .textarea");
var F=I.find(".Eleditor-insertImage");var A=o.find(".Eleditor-inputarea input");var L=o.find(".Eleditor-textEditor-colors");var u=o.find(".Eleditor-textEditor-fontsizes");var G=C.find(".Eleditor-undo");var E=o.find(".Eleditor-textEditor-lineheight");t.addClass("Eleditor-area");t.after(C);console.log("|--Eleditor Mounted To",t);var v=null,M=null;var q=function(T){v=T;T.addClass("Eleditor-active");var S=T.offset().top+T.outerHeight();f.each(I.find("li"),function(V,X){var W=f(X),U=W.attr("on-tag");if(U){if(v[0].tagName.toLocaleLowerCase()==U){W.show()}else{W.hide()}}});I.show();z();if(typeof P.animate==="function"){P.stop().animate({scrollTop:(S-150)+"px"},500)}else{P.scrollTop((S-150)+"px")}M&&M.refresh();document.body.style.overflow="hidden"};var z=function(){I.css({top:v.offset().top+v.outerHeight(),width:t.width()-5})};var y=function(){t.find(".Eleditor-active").removeClass("Eleditor-active");I.hide();document.body.style.overflow="auto"};var O=function(){I.hide();C.addClass("Eleditor-mask")};var r=function(){C.removeClass("Eleditor-mask")};var H=function(S){O();w.show();w.html("<p>"+S+"</p>")};var x=function(){_historys.push(arguments[0]);s()};var K=function(){if(_historys.length===0){return}var S=_historys.pop();if(S.m=="insertNode"){S.node.remove()}if(S.m=="editNode"){S.node.attr("style",S.unode.attr("style")||"").html(S.unode)}if(S.m=="deleteNode"){if(S.pnode.length>0){S.pnode.after(S.node)}else{t.prepend(S.node)}t.find(".Eleditor-placeholder").remove()}if(S.m=="deleteBeforeNode"){for(var T=S.bnode.length-1;T>=0;T--){S.node.before(S.bnode[T])}}if(S.m=="deleteAfterNode"){S.node.after(S.anode)}s()};var s=function(){if(_historys.length==0){G.hide()}else{G.show()}};var p=function(){r();w.hide()};var D=function(){o.attr("role","edit").show();N.html(v.html());N.attr("style",v.attr("style"));if(v.css("font-weight")=="bold"){o.find(".Eleditor-textStyle-bold").addClass("Eleditor-active")}if(v.css("text-decoration")=="underline"){o.find(".Eleditor-textStyle-underline").addClass("Eleditor-active")}if(v[0].tagName=="A"){o.attr("type","link");A.val(v.attr("href"))}else{o.attr("type","word")}var S=v.css("text-align");if(l(S,["left","center","right"])){o.find(".Eleditor-textStyle-align[align="+S+"]").addClass("Eleditor-active")}else{o.find(".Eleditor-textStyle-align").removeClass("Eleditor-active")}o.find(".Eleditor-textStyle-color span").css("background-color",v.css("color"))};if(l("insertImage",B.toolbars)){if(typeof WebUploader!="undefined"){M=WebUploader.create({auto:true,server:B.upload.server||"/upload",pick:F,duplicate:true,compress:typeof B.upload.compress=="undefined"?false:B.upload.compress,resize:false,fileSingleSizeLimit:B.upload.fileSizeLimit?B.upload.fileSizeLimit*1024*1024:undefined,accept:{title:"Images",extensions:"gif,jpg,jpeg,bmp,png,webp",mimeTypes:"image/*"}});M.on("uploadStart",function(S,T){y();H('上传图片中<span id="uploadProgress">1</span>%')});M.on("uploadProgress",function(S,T){f("#uploadProgress").html(parseFloat((T*100).toFixed(2)))});M.on("error",function(){if(arguments[0]=="Q_TYPE_DENIED"){alert("请上传图片格式文件")}else{if(arguments[0]=="F_EXCEED_SIZE"){alert("文件大小不能超过"+(arguments[1]/1048576)+"M")}}});M.on("uploadComplete",function(){p()});M.on("uploadSuccess",function(T,U){if(U.status==1){var S=f('<img src="'+U.url+'">');v.after(S);x({m:"insertNode",node:S})}else{alert(U.msg)}})}}var Q={insertText:function(){O();o.attr({"role":"insert","type":"word"}).show()},insertLink:function(){O();o.attr({"role":"insert","type":"link"}).show()},insertImage:function(){if(typeof WebUploader==="undefined"){alert("图片上传请手动引入插件根目录webuploader.min.js")}},insertHr:function(){var S=f('<div class="horizontal-line" style="padding: 10px 0;border-bottom: 1px solid #aaa;margin-bottom: 20px;"></div>');v.after(S);x({m:"insertNode",node:S});y()},editText:function(){if(l(v[0].tagName,a)){return this.insertText()}O();D()},deleteThis:function(){x({m:"deleteNode",node:v,pnode:v.prev()});v.remove();y();d(t,_placeHolder)},deleteBefore:function(){var U=v.prev();x({m:"deleteBeforeNode",node:v,bnode:v.prevAll()});var S;while(U.length>0){S=U.prev();U.remove();U=S}var T=v.parent();while(T.length>0&&!T.hasClass("Eleditor-area")){U=T.prev();while(U.length>0){S=U.prev();U.remove();U=S}T=T.parent()}y();d(t,_placeHolder)},deleteAfter:function(){var T=v.next();x({m:"deleteAfterNode",node:v,anode:v.nextAll()});var U;while(T.length>0){U=T.next();T.remove();T=U}var S=v.parent();while(S.length>0&&!S.hasClass("Eleditor-area")){T=S.next();while(T.length>0){U=T.next();T.remove();T=U}S=S.parent()}y();d(t,_placeHolder)},undo:function(){K();y()},cancel:function(){y()}};for(var J=0;J<B.toolbars.length;J++){if(typeof B.toolbars[J]==="object"){Q[B.toolbars[J].id]=B.toolbars[J].handle}}R.on("resize",function(){z()});I.on("click","ul li",function(){var T=f(this),S=T.attr("event");if(typeof Q[S]==="function"){if(typeof e[S]!="undefined"){Q[S]()}else{Q[S](v,T)!==false&&Q.cancel()}}});o.on("click",".Eleditor-textStyle-bold",function(){N.css("font-weight",f(this).hasClass("Eleditor-active")?"normal":"bold");
f(this).toggleClass("Eleditor-active")});o.on("click",".Eleditor-textStyle-underline",function(){N.css("text-decoration",f(this).hasClass("Eleditor-active")?"none":"underline");f(this).toggleClass("Eleditor-active")});o.on("click",".Eleditor-textStyle-color,.Eleditor-textStyle-bgColor",function(){var S=f(this);var T=S.hasClass("Eleditor-textStyle-bgColor")?"bgcolor":"color";L.find(".Eleditor-textEditor-modulePane span").html(T=="bgcolor"?"文字背景颜色":"文字颜色");L.attr("role",T).show();f(this).addClass("Eleditor-active")});o.on("click",".Eleditor-textStyle-fontSize",function(){u.show();f(this).addClass("Eleditor-active")});o.on("click",".Eleditor-textStyle-lineHeight",function(){E.show();f(this).addClass("Eleditor-active")});E.on("click","ul li",function(){if(!f(this).hasClass("Eleditor-inheritValue")){N.css("line-height",f(this).html())}else{N.css("line-height","inherit");o.find(".Eleditor-textStyle-lineHeight").removeClass("Eleditor-active")}E.hide()});u.on("click","ul li",function(){if(!f(this).hasClass("Eleditor-inheritValue")){N.css("font-size",f(this).html())}else{N.css("font-size","inherit");o.find(".Eleditor-textStyle-fontSize").removeClass("Eleditor-active")}u.hide()});o.on("click",".Eleditor-textStyle-align",function(){var S=f(this).attr("align");N.css({"text-align":S,"display":"block"});o.find(".Eleditor-textStyle-align.Eleditor-active").removeClass("Eleditor-active");f(this).addClass("Eleditor-active")});o.on("click",".Eleditor-textEditor-clean",function(){N.html("")});o.on("click",".Eleditor-cancel,.Eleditor-commit",function(){if(f(this).hasClass("Eleditor-commit")){var S=N.attr("style")||"";var U=N.html();var W=v.clone();if(!U){return alert("请输入内容文字")}if(o.attr("role")=="edit"||v.hasClass("Eleditor-placeholder")){if(o.attr("type")=="link"){var V=A.val();v.attr("href",V)}v.attr("style",S).removeClass("Eleditor-placeholder").html(U);x({m:"editNode",node:v,unode:W});z()}else{var T="";if(o.attr("type")=="link"){var V=A.val();T='<a target="_BLANK" style="'+S+'" href="'+V+'">'+U+"</a>"}else{T='<p style="'+S+'">'+U+"</p>"}var T=f(T);v.after(T);z();x({m:"insertNode",node:T})}}o.find(".Eleditor-active").removeClass("Eleditor-active");o.find(".Eleditor-textStyle-color span").removeAttr("style");N.removeAttr("style").html("");A.val("");r();o.hide();y()});L.on("click","ul li span",function(){var S=f(this).css("background-color");if(L.attr("role")=="color"){if(!f(this).hasClass("Eleditor-inheritValue")){N.css("color",S);o.find(".Eleditor-textStyle-color span").css("background-color",S)}else{N.css("color","inherit");o.find(".Eleditor-textStyle-color").removeClass("Eleditor-active").find("span").removeAttr("style")}}else{if(!f(this).hasClass("Eleditor-inheritValue")){N.css("background-color",S)}else{N.css("background-color","inherit");o.find(".Eleditor-textStyle-bgColor").removeClass("Eleditor-active")}}L.hide()});t.on("click","*",function(S){var T=f(this);if(!T.hasClass("Eleditor-active")){y();q(T)}return S.preventDefault()==0});return{append:function(){return t.append(arguments[0])},getContent:function(){return t.html()},getContentText:function(){return n(t.text())},destory:function(){t.removeAttr("Eleditor-Inited Eleditor-Uid");t.removeClass("Eleditor-area");t.off().find(".Eleditor-active").removeClass("Eleditor-active");C.find("*").off();C.remove();console.log("|--Eleditor "+_editorUid+" destoryed")}}}})(window);